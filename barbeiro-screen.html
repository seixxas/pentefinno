<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Barbeiro - PENTEFINO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="assets/logo.jpeg">
    <style>
        body { background-color: #f4f7f6; }
        .card-agendamento { border-left: 5px solid #0d6efd; transition: 0.3s; }
        .card-agendamento:hover { transform: scale(1.01); }
        .status-badge { font-size: 0.8rem; }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container">
            <span class="navbar-brand mb-0 h1">ðŸ’ˆ Painel PenteFino</span>
            <button class="btn btn-outline-light btn-sm" onclick="location.reload()">
                <i class="bi bi-arrow-clockwise"></i> Atualizar
            </button>
        </div>
    </nav>

    <div class="container">
        <div class="row mb-4 align-items-center">
            <div class="col-md-6">
                <h4>Agenda de Clientes</h4>
            </div>
            <div class="col-md-6 text-md-end">
                <label class="me-2">Filtrar por dia:</label>
                <input type="date" id="filtro-data" class="form-control d-inline-block w-auto">
            </div>
        </div>

        <div id="lista-agendamentos" class="row g-3">
            <div class="text-center mt-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p>Carregando agenda...</p>
            </div>
        </div>
    </div>

    <script>
        let todosAgendamentos = [];

        async function carregarAgenda() {
            try {
                const res = await fetch('/api/get-agendamentos');
                todosAgendamentos = await res.json();
                
                // Define a data do filtro como "Hoje" por padrÃ£o
                const hoje = new Date().toISOString().split('T')[0];
                document.getElementById('filtro-data').value = hoje;
                
                renderizarAgenda(hoje);
            } catch (error) {
                document.getElementById('lista-agendamentos').innerHTML = 
                    '<div class="alert alert-danger">Erro ao carregar dados.</div>';
            }
        }

        function renderizarAgenda(dataFiltro) {
            const container = document.getElementById('lista-agendamentos');
            const filtrados = todosAgendamentos.filter(a => a.date === dataFiltro);

            if (filtrados.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center mt-5">
                        <i class="bi bi-calendar-x display-1 text-muted"></i>
                        <p class="mt-3 text-muted">Nenhum agendamento para este dia.</p>
                    </div>`;
                return;
            }

            container.innerHTML = filtrados.map(a => `
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm card-agendamento">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">${a.time}</h5>
                                <span class="badge bg-primary status-badge">${a.barber}</span>
                            </div>
                            <h6 class="text-uppercase fw-bold mb-1">${a.email.split('@')[0]}</h6> 
                            <p class="card-text small text-muted mb-2">
                                <i class="bi bi-scissors me-1"></i> ${a.service}
                            </p>
                            <div class="d-grid mt-3">
                                <a href="https://wa.me/${a.phone}" target="_blank" class="btn btn-outline-success btn-sm">
                                    <i class="bi bi-whatsapp"></i> Contatar Cliente
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('filtro-data').addEventListener('change', (e) => {
            renderizarAgenda(e.target.value);
        });

        carregarAgenda();
    </script>
</body>
</html>